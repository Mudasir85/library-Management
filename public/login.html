<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library Management Login</title>
    <style>
      :root {
        --bg: #f6f7fb;
        --card: #ffffff;
        --text: #1f2937;
        --muted: #6b7280;
        --primary: #0f766e;
        --primary-dark: #115e59;
        --danger: #b91c1c;
        --border: #e5e7eb;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(180deg, #ecfeff 0%, var(--bg) 45%);
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
      }

      .card {
        width: 100%;
        max-width: 420px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 22px;
      }

      h1 {
        margin: 0 0 8px;
      }

      .subtitle {
        margin: 0 0 18px;
        color: var(--muted);
      }

      .message {
        margin: 0 0 12px;
        min-height: 20px;
        font-size: 14px;
      }

      .message.error {
        color: var(--danger);
      }

      .message.success {
        color: #166534;
      }

      form {
        display: grid;
        gap: 12px;
      }

      label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      input,
      button {
        width: 100%;
        border-radius: 8px;
        padding: 10px 12px;
        font-size: 14px;
      }

      input {
        border: 1px solid var(--border);
      }

      input:focus {
        outline: 2px solid #99f6e4;
        border-color: var(--primary);
      }

      button {
        border: none;
        cursor: pointer;
        background: var(--primary);
        color: #ffffff;
        margin-top: 4px;
      }

      button:hover {
        background: var(--primary-dark);
      }

      button:disabled {
        opacity: 0.7;
        cursor: default;
      }
    </style>
  </head>
  <body>
    <section class="card">
      <h1>Library Management</h1>
      <p class="subtitle">Login to access the dashboard.</p>

      <p id="message" class="message"></p>

      <form id="login-form">
        <div>
          <label for="username">Username</label>
          <input id="username" name="username" autocomplete="username" required />
        </div>

        <div>
          <label for="password">Password</label>
          <input
            id="password"
            name="password"
            type="password"
            autocomplete="current-password"
            required
          />
        </div>

        <button id="login-btn" type="submit">Login</button>
      </form>
    </section>

    <script>
      const form = document.getElementById('login-form');
      const message = document.getElementById('message');
      const loginBtn = document.getElementById('login-btn');

      function setMessage(text, isError = false) {
        message.textContent = text;
        message.className = `message ${isError ? 'error' : 'success'}`;
      }

      function clearMessage() {
        message.textContent = '';
        message.className = 'message';
      }

      function setSubmitting(isSubmitting) {
        loginBtn.disabled = isSubmitting;
        loginBtn.textContent = isSubmitting ? 'Logging in...' : 'Login';
      }

      async function checkExistingSession() {
        try {
          const response = await fetch('/api/auth/session');
          if (response.ok) {
            window.location.href = '/';
          }
        } catch (error) {
          // no-op
        }
      }

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        clearMessage();

        const payload = {
          username: document.getElementById('username').value.trim(),
          password: document.getElementById('password').value
        };

        if (!payload.username || !payload.password) {
          setMessage('Username and password are required.', true);
          return;
        }

        try {
          setSubmitting(true);
          const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          const data = await response.json().catch(() => null);
          if (!response.ok) {
            setMessage((data && data.message) || 'Login failed.', true);
            return;
          }

          setMessage('Login successful. Redirecting...');
          window.location.href = '/';
        } catch (error) {
          setMessage('Login failed. Please try again.', true);
        } finally {
          setSubmitting(false);
        }
      });

      checkExistingSession();
    </script>
  </body>
</html>
